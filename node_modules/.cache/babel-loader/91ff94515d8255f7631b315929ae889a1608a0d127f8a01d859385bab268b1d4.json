{"ast":null,"code":"import React,{useRef,useEffect,useCallback,useState}from'react';import{useSession}from'./SessionContext';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const AudioChat=()=>{const{sessionId}=useSession();const audioRef=useRef(null);const socket=useRef(null);const[isMuted,setIsMuted]=useState(false);const connectWebSocket=useCallback(()=>{if(!sessionId){console.error('Session ID is undefined. Unable to initialize WebSocket.');return;}// Initialize WebSocket connection\nsocket.current=new WebSocket(`ws://127.0.0.1:8080/ws/session/${sessionId}/`);socket.current.onopen=()=>{console.log('WebSocket connection established');};socket.current.onmessage=event=>{const data=JSON.parse(event.data);if(data.type==='audio'){console.log('Audio data received:',data.payload);// Handle received audio data (e.g., decode and play)\nplayAudio(data.payload);}};socket.current.onclose=()=>{console.warn('WebSocket disconnected.');};socket.current.onerror=error=>{console.error('WebSocket error:',error.message);};},[sessionId]);useEffect(()=>{connectWebSocket();return()=>{var _socket$current;(_socket$current=socket.current)===null||_socket$current===void 0?void 0:_socket$current.close();};},[connectWebSocket]);// Function to capture and send audio data\nconst startAudioCapture=async()=>{try{const stream=await navigator.mediaDevices.getUserMedia({audio:true});const audioContext=new AudioContext();// Load the audio processor\nawait audioContext.audioWorklet.addModule('audio-processor.js');const audioProcessor=new AudioWorkletNode(audioContext,'audio-processor');const input=audioContext.createMediaStreamSource(stream);input.connect(audioProcessor);audioProcessor.connect(audioContext.destination);// Send audio data to the WebSocket\naudioProcessor.port.onmessage=event=>{const audioChunk=event.data;if(socket.current){socket.current.send(JSON.stringify({type:'audio',payload:audioChunk}));}};}catch(error){console.error('Error capturing audio:',error.message);}};// Function to play incoming audio\nconst playAudio=audioBuffer=>{try{const audioContext=new AudioContext();const buffer=audioContext.createBuffer(1,audioBuffer.length,audioContext.sampleRate);buffer.copyToChannel(audioBuffer,0);const source=audioContext.createBufferSource();source.buffer=buffer;source.connect(audioContext.destination);source.start();}catch(error){console.error('Error playing audio:',error.message);}};const toggleMute=()=>{var _audioRef$current;if((_audioRef$current=audioRef.current)!==null&&_audioRef$current!==void 0&&_audioRef$current.srcObject){const audioTracks=audioRef.current.srcObject.getAudioTracks();audioTracks.forEach(track=>track.enabled=!isMuted);setIsMuted(!isMuted);}};return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"audio\",{ref:audioRef,autoPlay:true}),/*#__PURE__*/_jsx(\"button\",{onClick:toggleMute,children:isMuted?'Unmute':'Mute'}),/*#__PURE__*/_jsx(\"button\",{onClick:startAudioCapture,children:\"Start Audio\"})]});};export default AudioChat;","map":{"version":3,"names":["React","useRef","useEffect","useCallback","useState","useSession","jsx","_jsx","jsxs","_jsxs","AudioChat","sessionId","audioRef","socket","isMuted","setIsMuted","connectWebSocket","console","error","current","WebSocket","onopen","log","onmessage","event","data","JSON","parse","type","payload","playAudio","onclose","warn","onerror","message","_socket$current","close","startAudioCapture","stream","navigator","mediaDevices","getUserMedia","audio","audioContext","AudioContext","audioWorklet","addModule","audioProcessor","AudioWorkletNode","input","createMediaStreamSource","connect","destination","port","audioChunk","send","stringify","audioBuffer","buffer","createBuffer","length","sampleRate","copyToChannel","source","createBufferSource","start","toggleMute","_audioRef$current","srcObject","audioTracks","getAudioTracks","forEach","track","enabled","children","ref","autoPlay","onClick"],"sources":["C:/Users/wesle/OneDrive/Documents/VLCS/myProject/VirtualLCS/frontend/src/AudioChat.jsx"],"sourcesContent":["import React, { useRef, useEffect, useCallback, useState } from 'react';\r\nimport { useSession } from './SessionContext';\r\n\r\nconst AudioChat = () => {\r\n  const { sessionId } = useSession();\r\n  const audioRef = useRef(null);\r\n  const socket = useRef(null);\r\n  const [isMuted, setIsMuted] = useState(false);\r\n\r\n  const connectWebSocket = useCallback(() => {\r\n    if (!sessionId) {\r\n      console.error('Session ID is undefined. Unable to initialize WebSocket.');\r\n      return;\r\n    }\r\n\r\n    // Initialize WebSocket connection\r\n    socket.current = new WebSocket(`ws://127.0.0.1:8080/ws/session/${sessionId}/`);\r\n\r\n    socket.current.onopen = () => {\r\n      console.log('WebSocket connection established');\r\n    };\r\n\r\n    socket.current.onmessage = (event) => {\r\n      const data = JSON.parse(event.data);\r\n\r\n      if (data.type === 'audio') {\r\n        console.log('Audio data received:', data.payload);\r\n        // Handle received audio data (e.g., decode and play)\r\n        playAudio(data.payload);\r\n      }\r\n    };\r\n\r\n    socket.current.onclose = () => {\r\n      console.warn('WebSocket disconnected.');\r\n    };\r\n\r\n    socket.current.onerror = (error) => {\r\n      console.error('WebSocket error:', error.message);\r\n    };\r\n  }, [sessionId]);\r\n\r\n  useEffect(() => {\r\n    connectWebSocket();\r\n\r\n    return () => {\r\n      socket.current?.close();\r\n    };\r\n  }, [connectWebSocket]);\r\n\r\n  // Function to capture and send audio data\r\n  const startAudioCapture = async () => {\r\n    try {\r\n        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\r\n        const audioContext = new AudioContext();\r\n\r\n        // Load the audio processor\r\n        await audioContext.audioWorklet.addModule('audio-processor.js');\r\n        const audioProcessor = new AudioWorkletNode(audioContext, 'audio-processor');\r\n\r\n        const input = audioContext.createMediaStreamSource(stream);\r\n        input.connect(audioProcessor);\r\n        audioProcessor.connect(audioContext.destination);\r\n\r\n        // Send audio data to the WebSocket\r\n        audioProcessor.port.onmessage = (event) => {\r\n            const audioChunk = event.data;\r\n            if (socket.current) {\r\n                socket.current.send(JSON.stringify({\r\n                    type: 'audio',\r\n                    payload: audioChunk,\r\n                }));\r\n            }\r\n        };\r\n    } catch (error) {\r\n        console.error('Error capturing audio:', error.message);\r\n    }\r\n};\r\n\r\n\r\n  // Function to play incoming audio\r\n  const playAudio = (audioBuffer) => {\r\n    try {\r\n      const audioContext = new AudioContext();\r\n      const buffer = audioContext.createBuffer(1, audioBuffer.length, audioContext.sampleRate);\r\n      buffer.copyToChannel(audioBuffer, 0);\r\n\r\n      const source = audioContext.createBufferSource();\r\n      source.buffer = buffer;\r\n      source.connect(audioContext.destination);\r\n      source.start();\r\n    } catch (error) {\r\n      console.error('Error playing audio:', error.message);\r\n    }\r\n  };\r\n\r\n  const toggleMute = () => {\r\n    if (audioRef.current?.srcObject) {\r\n      const audioTracks = audioRef.current.srcObject.getAudioTracks();\r\n      audioTracks.forEach((track) => (track.enabled = !isMuted));\r\n      setIsMuted(!isMuted);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <audio ref={audioRef} autoPlay />\r\n      <button onClick={toggleMute}>{isMuted ? 'Unmute' : 'Mute'}</button>\r\n      <button onClick={startAudioCapture}>Start Audio</button>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AudioChat;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}