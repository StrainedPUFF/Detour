{"ast":null,"code":"import React,{useRef,useEffect,useCallback,useMemo}from'react';import io from'socket.io-client';import{jsx as _jsx}from\"react/jsx-runtime\";const AudioChat=_ref=>{let{sessionId}=_ref;const audioRef=useRef(null);const socket=useRef(io('http://localhost:8080')).current;// Persist socket instance\n// Memoized `peerConnections` object to prevent it from being re-initialized on every render\nconst peerConnections=useMemo(()=>({}),[]);// Memoized WebRTC configuration\nconst config=useMemo(()=>({iceServers:[{urls:'stun:stun.l.google.com:19302'}]}),[]);// Memoized event handlers\nconst handleOffer=useCallback(offer=>{const peerConnection=new RTCPeerConnection(config);peerConnections[offer.sender]=peerConnection;peerConnection.setRemoteDescription(new RTCSessionDescription(offer));navigator.mediaDevices.getUserMedia({audio:true}).then(stream=>{stream.getTracks().forEach(track=>peerConnection.addTrack(track,stream));});peerConnection.createAnswer().then(answer=>{peerConnection.setLocalDescription(answer);socket.emit('answer',{type:'answer',sdp:answer,sender:socket.id});});peerConnection.ontrack=event=>{audioRef.current.srcObject=event.streams[0];};peerConnection.onicecandidate=event=>{if(event.candidate){socket.emit('ice-candidate',{type:'candidate',candidate:event.candidate,sender:socket.id});}};},[config,peerConnections,socket]);const handleAnswer=useCallback(answer=>{const peerConnection=peerConnections[answer.sender];peerConnection.setRemoteDescription(new RTCSessionDescription(answer));},[peerConnections]);const handleNewICECandidateMsg=useCallback(msg=>{const candidate=new RTCIceCandidate(msg.candidate);const peerConnection=peerConnections[msg.sender];peerConnection.addIceCandidate(candidate);},[peerConnections]);// Main `useEffect` for socket event listeners and media setup\nuseEffect(()=>{socket.on('offer',handleOffer);socket.on('answer',handleAnswer);socket.on('ice-candidate',handleNewICECandidateMsg);navigator.mediaDevices.getUserMedia({audio:true}).then(stream=>{audioRef.current.srcObject=stream;socket.emit('join',sessionId);});// Cleanup function to prevent memory leaks\nreturn()=>{socket.off('offer',handleOffer);socket.off('answer',handleAnswer);socket.off('ice-candidate',handleNewICECandidateMsg);socket.disconnect();};},[socket,handleOffer,handleAnswer,handleNewICECandidateMsg,sessionId]);return/*#__PURE__*/_jsx(\"audio\",{ref:audioRef,autoPlay:true});};export default AudioChat;","map":{"version":3,"names":["React","useRef","useEffect","useCallback","useMemo","io","jsx","_jsx","AudioChat","_ref","sessionId","audioRef","socket","current","peerConnections","config","iceServers","urls","handleOffer","offer","peerConnection","RTCPeerConnection","sender","setRemoteDescription","RTCSessionDescription","navigator","mediaDevices","getUserMedia","audio","then","stream","getTracks","forEach","track","addTrack","createAnswer","answer","setLocalDescription","emit","type","sdp","id","ontrack","event","srcObject","streams","onicecandidate","candidate","handleAnswer","handleNewICECandidateMsg","msg","RTCIceCandidate","addIceCandidate","on","off","disconnect","ref","autoPlay"],"sources":["C:/Users/wesle/OneDrive/Documents/VLCS/myProject/VirtualLCS/frontend/src/AudioChat.jsx"],"sourcesContent":["import React, { useRef, useEffect, useCallback, useMemo } from 'react';\r\nimport io from 'socket.io-client';\r\n\r\nconst AudioChat = ({ sessionId }) => {\r\n  const audioRef = useRef(null);\r\n  const socket = useRef(io('http://localhost:8080')).current; // Persist socket instance\r\n\r\n  // Memoized `peerConnections` object to prevent it from being re-initialized on every render\r\n  const peerConnections = useMemo(() => ({}), []);\r\n\r\n  // Memoized WebRTC configuration\r\n  const config = useMemo(() => ({\r\n    iceServers: [{ urls: 'stun:stun.l.google.com:19302' }]\r\n  }), []);\r\n\r\n  // Memoized event handlers\r\n  const handleOffer = useCallback((offer) => {\r\n    const peerConnection = new RTCPeerConnection(config);\r\n    peerConnections[offer.sender] = peerConnection;\r\n    peerConnection.setRemoteDescription(new RTCSessionDescription(offer));\r\n    navigator.mediaDevices.getUserMedia({ audio: true })\r\n      .then(stream => {\r\n        stream.getTracks().forEach(track => peerConnection.addTrack(track, stream));\r\n      });\r\n    peerConnection.createAnswer()\r\n      .then(answer => {\r\n        peerConnection.setLocalDescription(answer);\r\n        socket.emit('answer', { type: 'answer', sdp: answer, sender: socket.id });\r\n      });\r\n    peerConnection.ontrack = (event) => {\r\n      audioRef.current.srcObject = event.streams[0];\r\n    };\r\n    peerConnection.onicecandidate = (event) => {\r\n      if (event.candidate) {\r\n        socket.emit('ice-candidate', { type: 'candidate', candidate: event.candidate, sender: socket.id });\r\n      }\r\n    };\r\n  }, [config, peerConnections, socket]);\r\n\r\n  const handleAnswer = useCallback((answer) => {\r\n    const peerConnection = peerConnections[answer.sender];\r\n    peerConnection.setRemoteDescription(new RTCSessionDescription(answer));\r\n  }, [peerConnections]);\r\n\r\n  const handleNewICECandidateMsg = useCallback((msg) => {\r\n    const candidate = new RTCIceCandidate(msg.candidate);\r\n    const peerConnection = peerConnections[msg.sender];\r\n    peerConnection.addIceCandidate(candidate);\r\n  }, [peerConnections]);\r\n\r\n  // Main `useEffect` for socket event listeners and media setup\r\n  useEffect(() => {\r\n    socket.on('offer', handleOffer);\r\n    socket.on('answer', handleAnswer);\r\n    socket.on('ice-candidate', handleNewICECandidateMsg);\r\n\r\n    navigator.mediaDevices.getUserMedia({ audio: true })\r\n      .then(stream => {\r\n        audioRef.current.srcObject = stream;\r\n        socket.emit('join', sessionId);\r\n      });\r\n\r\n    // Cleanup function to prevent memory leaks\r\n    return () => {\r\n      socket.off('offer', handleOffer);\r\n      socket.off('answer', handleAnswer);\r\n      socket.off('ice-candidate', handleNewICECandidateMsg);\r\n      socket.disconnect();\r\n    };\r\n  }, [socket, handleOffer, handleAnswer, handleNewICECandidateMsg, sessionId]);\r\n\r\n  return <audio ref={audioRef} autoPlay />;\r\n};\r\n\r\nexport default AudioChat;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}