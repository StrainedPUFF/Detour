{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\wesle\\\\OneDrive\\\\Documents\\\\VLCS\\\\myProject\\\\VirtualLCS\\\\frontend\\\\src\\\\AudioChat.jsx\",\n  _s = $RefreshSig$();\nimport React, { useRef, useEffect } from 'react';\nimport io from 'socket.io-client';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AudioChat = ({\n  sessionId\n}) => {\n  _s();\n  const audioRef = useRef(null);\n  const peerConnections = {};\n  const config = {\n    iceServers: [{\n      urls: 'stun:stun.l.google.com:19302'\n    }]\n  };\n  const socket = io('http://localhost:8080'); // Your server URL\n\n  useEffect(() => {\n    socket.on('offer', handleOffer);\n    socket.on('answer', handleAnswer);\n    socket.on('ice-candidate', handleNewICECandidateMsg);\n    navigator.mediaDevices.getUserMedia({\n      audio: true\n    }).then(stream => {\n      audioRef.current.srcObject = stream;\n      socket.emit('join', sessionId);\n    });\n    return () => {\n      socket.disconnect();\n    };\n  }, [sessionId, handleAnswer]);\n  const handleOffer = offer => {\n    const peerConnection = new RTCPeerConnection(config);\n    peerConnections[offer.sender] = peerConnection;\n    peerConnection.setRemoteDescription(new RTCSessionDescription(offer));\n    navigator.mediaDevices.getUserMedia({\n      audio: true\n    }).then(stream => {\n      stream.getTracks().forEach(track => peerConnection.addTrack(track, stream));\n    });\n    peerConnection.createAnswer().then(answer => {\n      peerConnection.setLocalDescription(answer);\n      socket.emit('answer', {\n        type: 'answer',\n        sdp: answer,\n        sender: socket.id\n      });\n    });\n    peerConnection.ontrack = handleTrackEvent;\n    peerConnection.onicecandidate = handleICECandidateEvent;\n  };\n  const handleAnswer = answer => {\n    const peerConnection = peerConnections[answer.sender];\n    peerConnection.setRemoteDescription(new RTCSessionDescription(answer));\n  };\n  const handleNewICECandidateMsg = msg => {\n    const candidate = new RTCIceCandidate(msg.candidate);\n    const peerConnection = peerConnections[msg.sender];\n    peerConnection.addIceCandidate(candidate);\n  };\n  const handleTrackEvent = event => {\n    audioRef.current.srcObject = event.streams[0];\n  };\n  const handleICECandidateEvent = event => {\n    if (event.candidate) {\n      socket.emit('ice-candidate', {\n        type: 'candidate',\n        candidate: event.candidate,\n        sender: socket.id\n      });\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"audio\", {\n    ref: audioRef,\n    autoPlay: true\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 64,\n    columnNumber: 10\n  }, this);\n};\n_s(AudioChat, \"+byXHHf22FzALubYzgUeSQRtz1Y=\");\n_c = AudioChat;\nexport default AudioChat;\nvar _c;\n$RefreshReg$(_c, \"AudioChat\");","map":{"version":3,"names":["React","useRef","useEffect","io","jsxDEV","_jsxDEV","AudioChat","sessionId","_s","audioRef","peerConnections","config","iceServers","urls","socket","on","handleOffer","handleAnswer","handleNewICECandidateMsg","navigator","mediaDevices","getUserMedia","audio","then","stream","current","srcObject","emit","disconnect","offer","peerConnection","RTCPeerConnection","sender","setRemoteDescription","RTCSessionDescription","getTracks","forEach","track","addTrack","createAnswer","answer","setLocalDescription","type","sdp","id","ontrack","handleTrackEvent","onicecandidate","handleICECandidateEvent","msg","candidate","RTCIceCandidate","addIceCandidate","event","streams","ref","autoPlay","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Users/wesle/OneDrive/Documents/VLCS/myProject/VirtualLCS/frontend/src/AudioChat.jsx"],"sourcesContent":["import React, { useRef, useEffect } from 'react';\r\nimport io from 'socket.io-client';\r\n\r\nconst AudioChat = ({ sessionId }) => {\r\n  const audioRef = useRef(null);\r\n  const peerConnections = {};\r\n  const config = { iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] };\r\n  const socket = io('http://localhost:8080'); // Your server URL\r\n\r\n  useEffect(() => {\r\n    socket.on('offer', handleOffer);\r\n    socket.on('answer', handleAnswer);\r\n    socket.on('ice-candidate', handleNewICECandidateMsg);\r\n\r\n    navigator.mediaDevices.getUserMedia({ audio: true })\r\n      .then(stream => {\r\n        audioRef.current.srcObject = stream;\r\n        socket.emit('join', sessionId);\r\n      });\r\n\r\n    return () => {\r\n      socket.disconnect();\r\n    };\r\n  }, [sessionId, handleAnswer]);\r\n\r\n  const handleOffer = (offer) => {\r\n    const peerConnection = new RTCPeerConnection(config);\r\n    peerConnections[offer.sender] = peerConnection;\r\n    peerConnection.setRemoteDescription(new RTCSessionDescription(offer));\r\n    navigator.mediaDevices.getUserMedia({ audio: true })\r\n      .then(stream => {\r\n        stream.getTracks().forEach(track => peerConnection.addTrack(track, stream));\r\n      });\r\n    peerConnection.createAnswer()\r\n      .then(answer => {\r\n        peerConnection.setLocalDescription(answer);\r\n        socket.emit('answer', { type: 'answer', sdp: answer, sender: socket.id });\r\n      });\r\n    peerConnection.ontrack = handleTrackEvent;\r\n    peerConnection.onicecandidate = handleICECandidateEvent;\r\n  };\r\n\r\n  const handleAnswer = (answer) => {\r\n    const peerConnection = peerConnections[answer.sender];\r\n    peerConnection.setRemoteDescription(new RTCSessionDescription(answer));\r\n  };\r\n\r\n  const handleNewICECandidateMsg = (msg) => {\r\n    const candidate = new RTCIceCandidate(msg.candidate);\r\n    const peerConnection = peerConnections[msg.sender];\r\n    peerConnection.addIceCandidate(candidate);\r\n  };\r\n\r\n  const handleTrackEvent = (event) => {\r\n    audioRef.current.srcObject = event.streams[0];\r\n  };\r\n\r\n  const handleICECandidateEvent = (event) => {\r\n    if (event.candidate) {\r\n      socket.emit('ice-candidate', { type: 'candidate', candidate: event.candidate, sender: socket.id });\r\n    }\r\n  };\r\n\r\n  return <audio ref={audioRef} autoPlay />;\r\n};\r\n\r\nexport default AudioChat;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}